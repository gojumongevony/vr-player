<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>1 Local VR Player - Full Immersion</title>

<script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>

<style>
body {
    margin: 0;
    overflow: hidden;
    font-family: Arial, sans-serif;
}

#startup {
    position: absolute;
    inset: 0;
    background: rgba(0,0,0,0.9);
    color: white;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    z-index: 100;
    gap: 20px;
}

.mode-group {
    display: flex;
    gap: 20px;
}

.mode-option {
    padding: 12px 24px;
    background: rgba(255,255,255,0.1);
    border: 2px solid #555;
    border-radius: 8px;
    cursor: pointer;
}

.mode-option.active {
    background: #0078d7;
    border-color: #0078d7;
}

#choose-btn {
    padding: 14px 28px;
    font-size: 18px;
    background: #0078d7;
    color: white;
    border: none;
    border-radius: 8px;
    cursor: pointer;
}

#controls {
    position: absolute;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(0,0,0,0.6);
    padding: 10px 20px;
    border-radius: 10px;
    color: white;
    z-index: 10;
    display: none;
    flex-direction: column;
    align-items: center;
    gap: 10px;
}

#seek-bar {
    width: 600px;
    max-width: 90vw;
}

button {
    background: rgba(255,255,255,0.2);
    border: none;
    color: white;
    padding: 8px 16px;
    border-radius: 5px;
    cursor: pointer;
}
</style>
</head>

<body>

<!-- ---------- Startup ---------- -->
<div id="startup">
    <h1>Local VR Player</h1>

    <div class="mode-group">
        <div id="opt-180" class="mode-option active">180째 VR</div>
        <div id="opt-360" class="mode-option">360째 VR</div>
    </div>

    <button id="choose-btn">Choose Video File</button>
    <input id="file-input" type="file" accept="video/mp4,video/webm,video/ogg" hidden>
</div>

<!-- ---------- 2D Controls ---------- -->
<div id="controls">
    <div>
        <button id="enter-vr">Enter VR</button>
        <button id="play-pause">Play</button>
        <button id="mute">Mute</button>
        <button id="zoom-in">Zoom In</button>
        <button id="zoom-out">Zoom Out</button>
    </div>
    <input type="range" id="seek-bar" min="0" max="100" step="0.1">
    <div id="time-display">00:00 / 00:00</div>
</div>

<!-- ---------- A-Frame Scene ---------- -->
<a-scene embedded vr-mode-ui="enabled: false" style="width:100vw; height:100vh;">
    <a-assets>
        <video
            id="vr-video"
            autoplay
            muted
            loop
            crossorigin="anonymous"
            playsinline
            webkit-playsinline>
        </video>
    </a-assets>

    <!-- Main videosphere - used for both modes -->
    <a-videosphere
        id="video-sphere"
        src="#vr-video"
        rotation="0 180 0"
        material="shader: flat; side: back">
    </a-videosphere>

    <!-- Black backdrop to hide back content in 180째 mode -->
    <a-sphere
        id="backdrop"
        radius="9.9"
        theta-start="0"
        theta-length="180"
        rotation="0 0 0"
        material="color: black; side: front"
        visible="true">
    </a-sphere>

    <a-entity id="camera" camera look-controls position="0 1.6 0">
        <a-cursor fuse="true" fuse-timeout="1500"></a-cursor>
    </a-entity>

    <!-- ---------- VR Controls ---------- -->
    <a-entity id="vr-controls" visible="false" position="0 -0.5 -1.5" rotation="-30 0 0">
        <a-plane id="vr-play" width="0.6" height="0.3" position="-0.8 0.4 0" color="#333">
            <a-text value="Play" align="center" color="white" position="0 0 0.01"></a-text>
        </a-plane>

        <a-plane id="vr-mute" width="0.6" height="0.3" position="0 0.4 0" color="#333">
            <a-text value="Mute" align="center" color="white" position="0 0 0.01"></a-text>
        </a-plane>

        <a-plane id="vr-zoom-in" width="0.6" height="0.3" position="0.8 0.4 0" color="#333">
            <a-text value="Zoom +" align="center" color="white" position="0 0 0.01"></a-text>
        </a-plane>

        <a-text id="vr-time" value="00:00 / 00:00" align="center" color="white" position="0 -0.2 0"></a-text>
    </a-entity>
</a-scene>

<script>
const startup = document.getElementById('startup');
const chooseBtn = document.getElementById('choose-btn');
const fileInput = document.getElementById('file-input');
const video = document.getElementById('vr-video');
const scene = document.querySelector('a-scene');
const controls = document.getElementById('controls');

const enterVrBtn = document.getElementById('enter-vr');
const playPauseBtn = document.getElementById('play-pause');
const muteBtn = document.getElementById('mute');
const seekBar = document.getElementById('seek-bar');
const timeDisplay = document.getElementById('time-display');
const zoomInBtn = document.getElementById('zoom-in');
const zoomOutBtn = document.getElementById('zoom-out');
const camera = document.getElementById('camera');

const vrControls = document.getElementById('vr-controls');
const vrPlayText = document.querySelector('#vr-play a-text');
const vrMuteText = document.querySelector('#vr-mute a-text');
const vrTimeText = document.getElementById('vr-time');

const sphere = document.getElementById('video-sphere');
const backdrop = document.getElementById('backdrop');

let fov = 80;

/* ---------- Mode Selection - Toggle black backdrop for 180째 ---------- */
const opt180 = document.getElementById('opt-180');
const opt360 = document.getElementById('opt-360');

opt180.onclick = () => {
    opt180.classList.add('active');
    opt360.classList.remove('active');
    sphere.setAttribute('rotation', '0 180 0');
    backdrop.setAttribute('visible', true);
};

opt360.onclick = () => {
    opt360.classList.add('active');
    opt180.classList.remove('active');
    sphere.setAttribute('rotation', '0 0 0');
    backdrop.setAttribute('visible', false);
};

/* ---------- File Load ---------- */
chooseBtn.onclick = () => fileInput.click();

fileInput.onchange = e => {
    const file = e.target.files[0];
    if (!file) return;

    video.src = URL.createObjectURL(file);
    video.load();

    startup.style.display = 'none';
    controls.style.display = 'flex';

    video.onloadeddata = () => {
        video.muted = true;
        video.play();
    };
};

/* ---------- VR Toggle ---------- */
enterVrBtn.onclick = () => {
    scene.is('vr-mode') ? scene.exitVR() : scene.enterVR();
};

scene.addEventListener('enter-vr', () => {
    controls.style.display = 'none';
    vrControls.setAttribute('visible', true);
    enterVrBtn.textContent = 'Exit VR';
});

scene.addEventListener('exit-vr', () => {
    controls.style.display = 'flex';
    vrControls.setAttribute('visible', false);
    enterVrBtn.textContent = 'Enter VR';
});

/* ---------- Playback ---------- */
function togglePlay() {
    video.paused ? video.play() : video.pause();
    const label = video.paused ? 'Play' : 'Pause';
    playPauseBtn.textContent = label;
    vrPlayText.setAttribute('value', label);
}

function toggleMute() {
    video.muted = !video.muted;
    const label = video.muted ? 'Unmute' : 'Mute';
    muteBtn.textContent = label;
    vrMuteText.setAttribute('value', label);
}

playPauseBtn.onclick = togglePlay;
muteBtn.onclick = toggleMute;
document.getElementById('vr-play').onclick = togglePlay;
document.getElementById('vr-mute').onclick = toggleMute;

/* ---------- Zoom ---------- */
zoomInBtn.onclick = () => {
    fov = Math.max(30, fov - 10);
    camera.setAttribute('camera', 'fov', fov);
};

zoomOutBtn.onclick = () => {
    fov = Math.min(120, fov + 10);
    camera.setAttribute('camera', 'fov', fov);
};

document.getElementById('vr-zoom-in').onclick = zoomInBtn.onclick;

/* ---------- Progress ---------- */
video.ontimeupdate = () => {
    const p = video.currentTime / video.duration || 0;
    seekBar.value = p * 100;
    const t = `${fmt(video.currentTime)} / ${fmt(video.duration)}`;
    timeDisplay.textContent = t;
    vrTimeText.setAttribute('value', t);
};

seekBar.oninput = () => {
    video.currentTime = (seekBar.value / 100) * video.duration;
};

function fmt(s) {
    if (!s || isNaN(s)) return '00:00';
    const m = Math.floor(s / 60);
    const sec = Math.floor(s % 60);
    return `${m.toString().padStart(2,'0')}:${sec.toString().padStart(2,'0')}`;
}
</script>

</body>
</html>
